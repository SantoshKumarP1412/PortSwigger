## Exploiting XXE to perform SSRF attacks

## Solution

Visit a product page, click "Check stock", and intercept the resulting POST request in Burp Suite.

<img width="1190" alt="image" src="https://github.com/SantoshKumarP1412/PortSwigger/assets/140537888/4f62988f-ff75-4a26-bab6-052b10e85eef">

Insert the following external entity definition in between the XML declaration and the stockCheck element:

```<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest"> ]>```

<img width="1439" alt="image" src="https://github.com/SantoshKumarP1412/PortSwigger/assets/140537888/e9d34c4c-d938-4ed3-ada6-f269b1faa439">

Replace the productId number with a reference to the external entity:

```&xxe;```

<img width="1439" alt="image" src="https://github.com/SantoshKumarP1412/PortSwigger/assets/140537888/900418eb-155b-4e8a-bd4c-35066389c1f3">

The response should contain "Invalid product ID:" followed by the response from the metadata endpoint, which will initially be a folder name.

<img width="1437" alt="image" src="https://github.com/SantoshKumarP1412/PortSwigger/assets/140537888/8069934a-0431-4ecb-8372-6e9f032fcf82">

Iteratively update the URL in the DTD to explore the API until you reach /latest/meta-data/iam/security-credentials/admin. This should return JSON containing the SecretAccessKey.

<img width="1439" alt="image" src="https://github.com/SantoshKumarP1412/PortSwigger/assets/140537888/40da6d26-a73a-4f23-8bf6-92da0a928dd0">

<img width="1439" alt="image" src="https://github.com/SantoshKumarP1412/PortSwigger/assets/140537888/0149aa8e-caa5-4b76-bb0c-836656196c20">




